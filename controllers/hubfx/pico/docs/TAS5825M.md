# TAS5825M Codec Support

## Overview

The TAS5825M is a high-power digital audio amplifier with integrated DSP from Texas Instruments. It's used in various audio projects including the [Bassowl HAT](https://github.com/Darmur/bassowl-hat).

## Features

- **Digital Input:** I2S audio interface (16/20/24/32-bit)
- **I2C Control:** Address 0x4C, Book/Page register architecture
- **High Power Output:** 30W+ per channel (supply voltage dependent)
- **Supply Voltages:** 12V, 15V, 20V, 24V supported
- **Digital Volume:** -100dB to +24dB in 0.5dB steps
- **Built-in DSP:** EQ, DRC, crossover, bass management
- **Fault Protection:** Over-current, over-temperature, DC detection

## Hardware Connections

### I2S Audio (from Pico to TAS5825M)
- **GP6** → TAS5825M SDIN (Audio Data)
- **GP7** → TAS5825M BCLK (Bit Clock)
- **GP8** → TAS5825M LRCLK (Word Select)

### I2C Control (from Pico to TAS5825M)
- **GP4** → TAS5825M SDA
- **GP5** → TAS5825M SCL

### Power
- **3.3V** → TAS5825M DVDD (digital supply)
- **12-24V** → TAS5825M PVDD (power supply)
- **GND** → Common ground

## Configuration

### In hubfx_pico.ino

**Step 1:** Enable TAS5825M codec (comment out others):
```cpp
// #define USE_WM8960_CODEC
#define USE_TAS5825_CODEC
// #define USE_SIMPLE_I2S_CODEC
```

**Step 2:** Select supply voltage:
```cpp
// In init_audio() function:
audioCodec.begin(Wire, 4, 5, 44100, TAS5825M_20V);  // 20V supply

// Available options:
// TAS5825M_12V - 12V supply (11.74 Vpeak, -8.0dB analog gain)
// TAS5825M_15V - 15V supply (14.73 Vpeak, -5.05dB analog gain)
// TAS5825M_20V - 20V supply (19.73 Vpeak, -3.05dB analog gain)
// TAS5825M_24V - 24V supply (23.72 Vpeak, -2.05dB analog gain)
```

## Usage Examples

### Basic Volume Control
```cpp
// Set volume in dB (-100.0 to +24.0)
audioCodec.setVolumeDB(0.0f);     // 0dB (unity gain)
audioCodec.setVolumeDB(-6.0f);    // -6dB (half power)
audioCodec.setVolumeDB(-20.0f);   // -20dB (quiet)
```

### Mute Control
```cpp
audioCodec.setMute(true);   // Mute
audioCodec.setMute(false);  // Unmute
```

### Fault Monitoring
```cpp
audioCodec.clearFaults();   // Clear any fault conditions
audioCodec.dumpRegisters(); // Debug: print register values
```

## DSP Programming

### Basic Configuration (Default)
The driver provides a basic initialization sequence that allows audio playback with minimal DSP processing (identity/pass-through coefficients).

### Advanced Configuration (PPC3)
For full DSP capabilities (EQ, DRC, crossover, etc.), you need to generate coefficient files using **TI PurePath Console 3 (PPC3)** software:

1. Download PPC3 from TI website
2. Load TAS5825M module
3. Configure audio processing (EQ, DRC, etc.)
4. Export coefficient configuration
5. Convert to initialization sequence
6. Update `initDSPCoefficients()` in `tas5825_codec.cpp`

See the [bassowl-hat install scripts](https://github.com/Darmur/bassowl-hat/tree/main/scripts) for examples of full coefficient initialization.

## Audio Format Support

The TAS5825M supports multiple audio formats. The current driver configures for:
- **Sample Rate:** 44.1kHz (configurable in `begin()`)
- **Bit Depth:** 16-bit (I2S standard)
- **Format:** I2S

To use Left-Justified format:
```cpp
// In tas5825_codec.cpp, after initialization:
writeRegister(0x33, 0x30);  // Set Left-Justified mode
```

See [TI E2E Forum thread](https://e2e.ti.com/support/audio-group/audio/f/audio-forum/737485/) for format configuration details.

## Troubleshooting

### No Audio Output
1. Check I2C connection (SDA/SCL on GP4/GP5)
2. Verify supply voltage is correct (12-24V on PVDD)
3. Check I2S connections (SDIN, BCLK, LRCLK)
4. Monitor serial output for initialization errors
5. Use `audioCodec.dumpRegisters()` to verify register values

### Distorted Audio
1. Lower volume: `audioCodec.setVolumeDB(-6.0f)`
2. Check supply voltage matches configuration
3. Ensure proper speaker impedance (4-8Ω)
4. Check for thermal issues (TAS5825M can get hot)

### I2C Communication Errors
1. Verify I2C address (0x4C)
2. Check pull-up resistors on SDA/SCL (1.8kΩ - 4.7kΩ)
3. Reduce I2C clock speed if needed (currently 100kHz)
4. Check for I2C conflicts with other devices

## Register Reference

Key registers in the TAS5825M:

| Register | Name | Function |
|----------|------|----------|
| 0x00 | PAGE | Page select (0x00-0xFF) |
| 0x7F | BOOK | Book select (0x00-0xFF) |
| 0x03 | DEVICE_CTRL | Play/HIZ/Mute control |
| 0x4C | DIGITAL_VOL | Digital volume (-100dB to +24dB) |
| 0x53/0x54 | ANALOG_GAIN | Analog gain (supply dependent) |
| 0x30 | SDOUT_SEL | Serial data output routing |
| 0x60 | CLK_CFG | Clock configuration |
| 0x78 | FAULT_CLEAR | Fault status clear |

Full register map available in [TAS5825M datasheet](https://www.ti.com/product/TAS5825M).

## References

- **TI Product Page:** https://www.ti.com/product/TAS5825M
- **Bassowl HAT Project:** https://github.com/Darmur/bassowl-hat
- **TI E2E Forum:** https://e2e.ti.com/support/audio-group/audio/
- **PurePath Console 3:** https://www.ti.com/tool/PUREPATHCONSOLE-SW

## Credits

TAS5825M driver based on work from:
- **Bassowl HAT** by Dario Murgia
- **TI Reference Driver** by Andy Liu
- **TI E2E Community** discussions

## License

Part of the ScaleFX project. See main project LICENSE file.
